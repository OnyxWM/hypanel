2026-01-16: Completed server persistence implementation
- Updated database schema with installState, lastError, jarPath, assetsPath, and serverRoot fields
- Implemented canonical server root at ~/hytale/<id> for hypanel user  
- Added proper ownership/permissions handling via chown/chmod
- Modified ServerManager to restore servers from database on daemon restart
- Tested database schema and server creation functionality
- All PRD steps for server persistence now passing

2026-01-17: Implemented Hytale server installation automation
- Created Installer.ts service class for hytale-downloader integration
- Added installServer method to ServerManager with state management
- Added POST /api/servers/:id/install API endpoint with proper error handling
- Added WebSocket events for real-time installation progress streaming
- Implemented install state machine (NOT_INSTALLED → INSTALLING → INSTALLED/FAILED)
- Added progress tracking with stage updates (queued → downloading → verifying → ready/failed)
- Added robust error handling and retry capability
- Implemented file verification for HytaleServer.jar and Assets.zip
- Prevented concurrent installations per server
- Added comprehensive logging throughout installation process
- TypeScript compilation successful with all type safety checks passing
- Addresses PRD requirement #2: Automate Hytale server installation using bundled official hytale-downloader

2026-01-17: Implemented server configuration management API
- Added PUT /api/servers/:id endpoint for updating server settings after creation
- Created updateServerConfig method in ServerManager with proper validation
- Modified ServerInstance.config to be mutable for runtime updates
- Enhanced database updateServerConfig function with partial update support
- Maintains consistency between database and filesystem config storage
- Supports updating name, IP, port, version, maxMemory, maxPlayers, and other properties
- Added proper error handling for non-existent servers
- TypeScript compilation successful with all type checks passing
- Addresses PRD requirement #3: Server configuration management

2026-01-17: Implemented install progress streaming via websocket
- Added InstallProgress and InstallState types to frontend TypeScript definitions
- Added installServer method to ApiClient for triggering installations
- Created InstallProgressDisplay component with progress bars and stage indicators
- Updated ServerCard to show install state, progress bars, and install/retry buttons
- Added install progress WebSocket event handling to ServersPage and DashboardPage
- Implemented real-time install progress updates with proper error handling
- Supports all install stages: queued, downloading, extracting, verifying, ready, failed
- UI displays install failures with actionable error messages and retry functionality
- WebSocket events properly update server state in real-time across all components
- TypeScript compilation successful with all type safety checks passing
- Addresses PRD requirement #4: Install progress streaming via websocket + UI states

2026-01-17: Implemented concurrent install prevention and idempotent installations
- Added database-based install locking with tryStartInstallation function for atomic operations
- Implemented atomic install state management to prevent race conditions across multiple clients
- Added install recovery logic during daemon startup to handle crashed installations
- Implemented safe retry logic with cleanup of partial installation artifacts
- Added clear error responses for concurrent install requests with actionable messages
- Removed redundant checks in ServerManager and rely on database locking for consistency
- Mark interrupted installations as FAILED with actionable error messages about daemon restart
- Ensure installations survive daemon restarts with proper state recovery and cleanup
- TypeScript compilation successful with all type safety checks passing
- Addresses PRD requirement #5: Prevent concurrent installs and make installs idempotent per server

2026-01-17: Implemented official Hytale server launch requirements
- Modified ServerInstance.start() to use stored jarPath and assetsPath from SQLite database
- Added verification for jarPath and assetsPath existence before starting servers
- Updated command construction to use proper Hytale launch format: java -jar HytaleServer.jar --assets <Assets.zip>
- Added support for optional --bind <ip:port> setting with default 0.0.0.0:port
- Enhanced error handling with actionable error messages for missing/invalid paths
- Replaced auto-detection logic with database-driven path management for reliability
- Improved logging to show jar/assets paths being used for better debugging
- Added verification that server installState is INSTALLED before allowing start
- TypeScript compilation successful with all type safety checks passing
- Addresses PRD requirement #6: Start/stop uses official launch requirements

2026-01-17: Implemented server config.json management with GUI editor
- Added GET/PUT /api/servers/:id/config endpoints for config.json management with proper validation
- Created ServerConfig React component with form validation, error handling, and real-time updates
- Added Config tab to ServerDetailsPage with comprehensive editing capabilities
- Implemented guardrails to prevent config changes while server is running for safety
- Support core Hytale config fields: ServerName, MOTD, Password, MaxPlayers, MaxViewRadius, LocalCompressionEnabled, Defaults.World/Defaults.GameMode
- Added atomic config file writing with temporary files to prevent corruption
- Include proper JSON validation and user-friendly error messages throughout the UI
- Created reusable Alert UI component for success/error notifications
- TypeScript compilation successful with all type safety checks passing
- Addresses PRD requirement #6: Config management: server-root config.json editor (read/write, validated JSON) per official manual

2026-01-17: Implemented world config management with full UI integration
- Added GET /api/servers/:id/worlds endpoint to discover worlds under universe/worlds/ directory
- Added GET/PUT /api/servers/:id/worlds/:world/config endpoints for world config.json management
- Created WorldList React component displaying discovered worlds with selection functionality
- Created WorldConfig React component for editing safe world configuration fields
- Added Worlds tab to ServerDetailsPage with responsive split-pane layout
- Implemented server-running guardrails preventing config changes during operation
- Added atomic config file writing using temp files and rename to prevent corruption
- Support editing IsPvpEnabled, IsFallDamageEnabled, IsGameTimePaused, IsSpawningNPC, Seed, SaveNewChunks, IsUnloadingChunks
- Comprehensive error handling for missing worlds/config files with actionable messages
- Backend enforces config write restrictions even if UI is bypassed
- TypeScript compilation successful for both backend and frontend components
- Addresses PRD requirement #7: World config management: universe/worlds/<world>/config.json editor (list worlds, read/write)

2026-01-17: Verified guardrails implementation for config file editing
- Confirmed UI blocks config changes when server is online/starting with clear messaging
- Verified backend rejects server config writes via PUT /api/servers/:id/config when server is running
- Verified backend rejects world config writes via PUT /api/servers/:id/worlds/:world/config when server is running
- ServerConfig component disables all form fields when server is not offline/stopping
- WorldConfig component disables all form fields when server is not offline/stopping
- Both components show clear alert messages explaining why changes are blocked
- Config writes succeed normally after server is stopped
- Backend enforcement ensures bypassing UI is not possible
- Addresses PRD requirement #8: Guardrails: enforce stop-before-edit for config files (backend authoritative)

2026-01-17: Implemented comprehensive filesystem safety and path traversal protection
- Added sanitizePathComponent method to convert dangerous characters to safe underscores
- Implemented path containment verification using path.resolve() to ensure operations stay within server root
- Added world name sanitization in getWorldConfig and updateWorldConfig methods  
- Added regex validation for world names (alphanumeric, underscore, hyphen only)
- Added path validation to createServerSchema rejecting traversal characters (.., ~, /, \)
- Enhanced server deletion with proper server directory removal and path verification
- Created comprehensive test suite covering path sanitization and containment scenarios
- Verified protection against ../../../etc/passwd and other traversal attacks
- All filesystem operations now verify paths stay within ~/hypanel/hytale directory
- Server deletion only removes intended server directories with boundary checks
- TypeScript compilation successful with all safety measures in place
- Addresses PRD requirement #10: Filesystem safety: sanitize server ids/paths and prevent traversal

2026-01-17: Implemented auth guidance for /auth login device requirements
- Added AUTH_REQUIRED status to backend and frontend TypeScript types
- Updated ServerInstance to detect authentication requirement patterns in console output
- Added checkAuthRequirements method with pattern matching for auth signals
- Created AuthGuidance React component with clear instructions for users
- Updated ServerCard to show auth_required status with authenticate and stop buttons
- Enhanced ServerDetailsPage to display auth guidance in overview and console tabs
- Updated ConsolePage to handle auth_required status with proper UI indicators
- Modified console components to allow command input when auth is required
- Added comprehensive auth success detection to return status to online
- No sensitive authentication information is persisted beyond normal console streaming
- TypeScript compilation successful for both backend and frontend
- Addresses PRD requirement #8: Auth guidance: detect when server requires /auth login device and surface status in UI

2026-01-17: Implemented operational logging + structured errors for install/start/stop/config actions
- Created comprehensive error handling system with HypanelError types and structured responses
- Added operational logging functions for all major operations (install, start, stop, config, world-config)
- Enhanced Installer.ts with phase-by-phase logging (init, downloader_check, downloading, verification) with detailed context
- Updated ServerInstance.ts start/stop methods with comprehensive logging and error context
- Added structured error responses to all API endpoints with consistent format (code, message, details, suggested action)
- Implemented config operation logging with server and world-specific context
- Enhanced error context includes serverId, action, phase, and worldName for world config operations
- All errors include actionable suggested actions for better user experience
- TypeScript compilation successful with all new error types and logging functions
- Addresses PRD requirement #11: Operational logging + structured errors for install/start/stop/config actions

2026-01-17: Implemented comprehensive smoke tests for core workflows
- Fixed smoke test script in package.json to use tsx instead of compiled JS
- Added comprehensive Testing section to README.md documenting test approach
- Verified all smoke tests pass (4/4 tests) covering all required workflows:
  - SQLite database operations with temporary in-memory databases
  - Install state machine with mocked downloader (no network dependencies)
  - Install state transitions and websocket event emission verification
  - Full workflow integration from server creation to installation
- Tests run via single documented command: npm test from backend directory
- Uses isolated test environments with temp databases and mock services
- Addresses PRD requirement #12: Add smoke tests for core workflows (SQLite + install state machine + websocket events)

2026-01-17: Created comprehensive install.sh script for Ubuntu 24.04 and Debian 12
- Implemented idempotent installer that provisions hypanel user and installs dependencies
- Added OS detection with version validation for Ubuntu 24.04+ and Debian 12+ 
- Creates hypanel system user with home directory and prompts for password securely
- Installs base packages: curl, ca-certificates, unzip, tar, jq if missing
- Checks for Java 25 and installs via OpenJDK if missing from system repositories
- Installs Node.js 20 LTS from NodeSource repository if missing
- Creates required directories with proper permissions ownership (/opt/hypanel, /etc/hypanel, /var/log/hypanel, ~/hytale)
- Downloads and installs hypanel release from GitHub with configurable HYPANEL_VERSION
- Creates systemd service with security settings and proper user permissions
- Provides comprehensive completion information with URLs and service commands
- Enforces runtime permissions model (no root required after install)
- Script is fully idempotent with comprehensive error handling and logging
- Addresses PRD requirement #13: Create install.sh for Ubuntu 24.04 + Debian 12

2026-01-17: Implemented webpanel serving in production backend and updated install.sh with build process
- Modified backend to serve React/Vite webpanel static files in production mode
- Added multiple path resolution for webpanel dist directory (dev, install, production)
- Fixed TypeScript compilation to include root index.ts file
- Updated install.sh to build both backend and webpanel during installation  
- Fixed systemd service path to use compiled JavaScript instead of TypeScript source
- Added comprehensive error handling and logging for webpanel asset serving
- Ensured webpanel is accessible via Node daemon at port 3000
- Verified UI loads in browser with static file serving working correctly
- Addresses PRD requirement #14: install.sh downloads and installs hypanel release build and serves React/Vite panel from Node daemon

2026-01-17: Implemented comprehensive systemd service for hypanel daemon
- Created systemd service configuration with proper User=hypanel and WorkingDirectory=/opt/hypanel
- Added environment file loading from /etc/hypanel/hypanel.env for configurable runtime settings
- Implemented restart policy with Restart=always and RestartSec=10 for automatic recovery
- Added journal logging with StandardOutput=journal and StandardError=journal
- Applied security hardening with NoNewPrivileges, PrivateTmp, ProtectSystem=strict, ProtectHome=true
- Configured ReadWritePaths to allow access to server directories and logs while restricting system access
- Service enables and starts automatically with systemctl enable --now hypanel
- Added comprehensive status checking and error handling in installation script
- Included service management commands and log viewing in completion information
- Verified systemd service file syntax and configuration meets all PRD requirements
- Addresses PRD requirement #15: Systemd service: run hypanel as hypanel user with restart policy and journal logging